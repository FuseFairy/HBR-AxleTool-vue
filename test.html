<!DOCTYPE html>
<html>
<head>
  <title>Test HTML5 Drag and Drop with Button</title>
  <style>
    .draggable-button {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background-color: lightblue;
      margin: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: move;
      user-select: none;
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      pointer-events: auto;
    }
    .draggable-button img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
    }
    .draggable-button.drag-over {
      background-color: lightgreen;
    }
    .draggable-button.dragging {
      opacity: 0.6;
    }
    .container {
      display: flex;
      gap: 20px;
      padding: 20px;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="draggable-button" draggable="true" data-key="1">
      <img src="https://via.placeholder.com/120" alt="Image 1" draggable="false">
    </button>
    <button class="draggable-button" draggable="true" data-key="2">
      <img src="https://via.placeholder.com/120/FF0000" alt="Image 2" draggable="false">
    </button>
  </div>

  <script>
    const buttons = document.querySelectorAll('.draggable-button');

    buttons.forEach(button => {
      button.addEventListener('dragstart', (e) => {
        const key = button.dataset.key;
        console.log('dragstart', { key, target: e.target.tagName, button: button.tagName });
        if (e.target.tagName !== 'BUTTON') {
          console.log('dragstart blocked: not a button');
          e.preventDefault();
          return;
        }
        e.dataTransfer.setData('text/plain', key);
        e.dataTransfer.effectAllowed = 'move';
        button.classList.add('dragging');
      });

      button.addEventListener('dragenter', (e) => {
        console.log('dragenter', { key: button.dataset.key, target: e.target.tagName });
        e.preventDefault();
        button.classList.add('drag-over');
      });

      button.addEventListener('dragover', (e) => {
        console.log('dragover', { key: button.dataset.key, target: e.target.tagName });
        e.preventDefault();
      });

      button.addEventListener('dragleave', (e) => {
        console.log('dragleave', { key: button.dataset.key, target: e.target.tagName });
        button.classList.remove('drag-over');
      });

      button.addEventListener('drop', (e) => {
        console.log('drop', { key: button.dataset.key, target: e.target.tagName });
        e.preventDefault();
        e.stopPropagation();
        const sourceKey = e.dataTransfer.getData('text/plain');
        const sourceButton = document.querySelector(`[data-key="${sourceKey}"]`);
        if (sourceButton && sourceButton !== button) {
          console.log('Swapping', { source: sourceKey, target: button.dataset.key });
          const temp = button.innerHTML;
          button.innerHTML = sourceButton.innerHTML;
          sourceButton.innerHTML = temp;
        } else {
          console.log('drop skipped: invalid source or same button');
        }
        e.dataTransfer.clearData();
        button.classList.remove('drag-over');
      });

      button.addEventListener('dragend', (e) => {
        console.log('dragend', { key: button.dataset.key, target: e.target.tagName });
        button.classList.remove('dragging');
        buttons.forEach(b => b.classList.remove('drag-over'));
      });
    });
  </script>
</body>
</html>